# ユニット5: 在庫管理 (Inventory Management)

## 概要
商品の在庫数を管理し、在庫状態を他のユニットに提供する境界づけられたコンテキスト。
システムの在庫整合性を保つ重要な役割を担当する。

## 責任範囲
- 在庫数の管理
- 購入時の在庫自動減算
- 在庫状態の判定と提供
- 在庫切れ商品の表示制御
- 在庫の整合性保証（トランザクション処理）

## ユニット間インターフェース
**依存するユニット:**
- なし（他ユニットから参照される基盤ユニット）

**提供するAPI:**
- 在庫数取得
- 在庫減算
- 在庫状態判定（在庫あり/残りわずか/在庫切れ）
- 在庫チェック（購入可能数量の確認）

**このユニットを利用するユニット:**
- 商品カタログ管理ユニット（在庫状態の表示）
- ショッピングカート管理ユニット（在庫チェック）
- 注文・決済管理ユニット（在庫減算）

---

## ユーザーストーリー

### US-017: 購入時の在庫自動減算

**ストーリー**
> システムとして、注文確定時に書籍の在庫を自動的に減算したい。なぜなら、在庫の整合性を保つため。

**受け入れ基準**
- [ ] 注文が確定すると、購入された各書籍の在庫数が自動的に減算される
- [ ] 在庫数が0になった書籍は「在庫切れ」状態になる
- [ ] トランザクション処理により、データの整合性が保たれる
- [ ] 同時に複数の注文があっても、在庫が正しく管理される

**優先度**: 高（MVP）

---

### US-018: 在庫切れ商品の表示制御

**ストーリー**
> システムとして、在庫切れの書籍を適切に表示したい。なぜなら、ユーザーに在庫状態を正しく伝えるため。

**受け入れ基準**
- [ ] 在庫が0の書籍には「在庫切れ」と表示される
- [ ] 在庫切れの書籍は商品一覧に表示されるが、グレーアウトされる
- [ ] 在庫切れの書籍の詳細ページでは、「カートに追加」ボタンが無効化される
- [ ] 在庫切れの書籍はカートに追加できない

**優先度**: 高（MVP）

---

### US-019: 在庫状態の表示

**ストーリー**
> システムとして、書籍の在庫状態をリアルタイムで表示したい。なぜなら、ユーザーに正確な在庫情報を提供するため。

**受け入れ基準**
- [ ] 商品一覧と商品詳細ページで、在庫状態が表示される
- [ ] 在庫数が表示される（例：「在庫：5冊」）
- [ ] 在庫が少ない場合（例：5冊以下）、「残りわずか」と表示される
- [ ] 在庫が0の場合、「在庫切れ」と表示される

**優先度**: 高（MVP）

---

## ユニット内の依存関係
- US-017（在庫自動減算）が在庫管理の基盤機能
- US-018（在庫切れ商品の表示制御）とUS-019（在庫状態の表示）はUS-017に依存
- US-018とUS-19は並行実装可能

## 技術的考慮事項（参考）
本ユニットでは実装の詳細は記載しませんが、以下の点が重要です：
- 同時実行制御（複数ユーザーが同時に購入する場合）
- トランザクション処理（在庫減算の原子性保証）
- リアルタイム性（在庫状態の即時反映）
