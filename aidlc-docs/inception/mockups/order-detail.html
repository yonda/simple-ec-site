<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨æ–‡è©³ç´° - æ›¸ç±ECã‚µã‚¤ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="container">
            <h1>ğŸ“š æ›¸ç±ECã‚µã‚¤ãƒˆ</h1>
            <nav>
                <a href="index.html">å•†å“ä¸€è¦§</a>
                <a href="cart.html">ã‚«ãƒ¼ãƒˆ <span id="cart-count" class="badge">0</span></a>
                <a href="order-history.html">æ³¨æ–‡å±¥æ­´</a>
                <a href="#" onclick="logout(); return false;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
            </nav>
        </div>
    </header>

    <!-- æ³¨æ–‡è©³ç´° -->
    <main class="container">
        <h2>æ³¨æ–‡è©³ç´°</h2>

        <div id="order-detail-content">
            <!-- JavaScriptã§ç”Ÿæˆ -->
        </div>

        <div style="margin-top: 2rem;">
            <a href="order-history.html" class="btn btn-primary">æ³¨æ–‡å±¥æ­´ã«æˆ»ã‚‹</a>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 æ›¸ç±ECã‚µã‚¤ãƒˆ</p>
    </footer>

    <script src="data.js"></script>
    <script src="utils.js"></script>
    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
        const user = getCurrentUser();
        if (!user) {
            alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚');
            window.location.href = 'login.html';
        }

        const orderId = getQueryParam('id');
        const order = orderHistory.find(o => o.id === orderId);

        if (!order) {
            document.getElementById('order-detail-content').innerHTML = '<p class="no-results">æ³¨æ–‡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
        } else {
            let itemsHTML = '';
            order.items.forEach(item => {
                const product = getProductById(item.productId);
                if (!product) return;

                const subtotal = item.price * item.quantity;

                itemsHTML += `
                    <div class="cart-item">
                        <img src="${generateBookCover(product, 100, 140)}" alt="${product.title}">
                        <div class="cart-item-info">
                            <h3>${product.title}</h3>
                            <p class="author">${product.author}</p>
                            <p>æ•°é‡: ${item.quantity}</p>
                        </div>
                        <div class="cart-item-actions">
                            <p class="price">Â¥${item.price.toLocaleString()}</p>
                            <p>å°è¨ˆ: Â¥${subtotal.toLocaleString()}</p>
                        </div>
                    </div>
                `;
            });

            document.getElementById('order-detail-content').innerHTML = `
                <div class="cart-items">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                        <div>
                            <h3>æ³¨æ–‡æƒ…å ±</h3>
                            <p><strong>æ³¨æ–‡ç•ªå·:</strong> ${order.id}</p>
                            <p><strong>æ³¨æ–‡æ—¥:</strong> ${order.date}</p>
                            <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> <span style="color: #27ae60; font-weight: bold;">${order.status}</span></p>
                        </div>
                        <div>
                            <h3>é…é€å…ˆ</h3>
                            <p>${order.shippingAddress.name}</p>
                            <p>ã€’${order.shippingAddress.zipCode}</p>
                            <p>${order.shippingAddress.address}</p>
                            <p>TEL: ${order.shippingAddress.phone}</p>
                        </div>
                    </div>

                    <h3>æ³¨æ–‡å†…å®¹</h3>
                    ${itemsHTML}

                    <div class="cart-summary">
                        <div style="display: flex; justify-content: space-between; font-size: 1.3rem; font-weight: bold;">
                            <span>åˆè¨ˆé‡‘é¡:</span>
                            <span>Â¥${order.total.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
