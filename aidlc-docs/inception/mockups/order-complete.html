<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¨æ–‡å®Œäº† - æ›¸ç±ECã‚µã‚¤ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="container">
            <h1>ğŸ“š æ›¸ç±ECã‚µã‚¤ãƒˆ</h1>
            <nav>
                <a href="index.html">å•†å“ä¸€è¦§</a>
                <a href="cart.html">ã‚«ãƒ¼ãƒˆ <span id="cart-count" class="badge">0</span></a>
                <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <a href="register.html">æ–°è¦ç™»éŒ²</a>
            </nav>
        </div>
    </header>

    <!-- æ³¨æ–‡å®Œäº† -->
    <main class="container">
        <div class="form-container">
            <div class="success-message" style="text-align: center; padding: 2rem;">
                <h2 style="font-size: 2rem; margin-bottom: 1rem;">âœ“ ã”æ³¨æ–‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
                <p>ã”æ³¨æ–‡ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚</p>
            </div>

            <div id="order-details" style="margin-top: 2rem;">
                <!-- JavaScriptã§ç”Ÿæˆ -->
            </div>

            <div style="margin-top: 2rem; text-align: center;">
                <a href="index.html" class="btn btn-primary">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
                <div id="order-history-link" style="margin-top: 1rem;">
                    <!-- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã«è¡¨ç¤º -->
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 æ›¸ç±ECã‚µã‚¤ãƒˆ</p>
    </footer>

    <script src="data.js"></script>
    <script src="utils.js"></script>
    <script>
        const lastOrder = localStorage.getItem('last_order');

        if (!lastOrder) {
            document.getElementById('order-details').innerHTML = '<p class="error-message">æ³¨æ–‡æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
        } else {
            const order = JSON.parse(lastOrder);

            let itemsHTML = '';
            order.items.forEach(item => {
                const product = getProductById(item.productId);
                if (!product) return;

                const subtotal = product.price * item.quantity;

                itemsHTML += `
                    <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #ecf0f1;">
                        <span>${product.title} Ã— ${item.quantity}</span>
                        <span>Â¥${subtotal.toLocaleString()}</span>
                    </div>
                `;
            });

            document.getElementById('order-details').innerHTML = `
                <div style="background-color: #f8f9fa; padding: 1.5rem; border-radius: 5px;">
                    <h3 style="margin-bottom: 1rem;">æ³¨æ–‡è©³ç´°</h3>
                    <p><strong>æ³¨æ–‡ç•ªå·:</strong> ${order.id}</p>
                    <p><strong>æ³¨æ–‡æ—¥:</strong> ${order.date}</p>

                    <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">é…é€å…ˆ</h4>
                    <p>${order.shippingAddress.name}</p>
                    <p>ã€’${order.shippingAddress.zipCode}</p>
                    <p>${order.shippingAddress.address}</p>
                    <p>TEL: ${order.shippingAddress.phone}</p>

                    <h4 style="margin-top: 1.5rem; margin-bottom: 0.5rem;">æ³¨æ–‡å†…å®¹</h4>
                    ${itemsHTML}

                    <div style="display: flex; justify-content: space-between; padding: 1rem 0; font-size: 1.2rem; font-weight: bold;">
                        <span>åˆè¨ˆé‡‘é¡:</span>
                        <span>Â¥${order.total.toLocaleString()}</span>
                    </div>
                </div>
            `;

            // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã€æ³¨æ–‡å±¥æ­´ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
            const user = getCurrentUser();
            if (user) {
                document.getElementById('order-history-link').innerHTML = `
                    <a href="order-history.html" style="color: #3498db; text-decoration: none;">æ³¨æ–‡å±¥æ­´ã¯ã“ã¡ã‚‰</a>
                `;
            }
        }
    </script>
</body>
</html>
