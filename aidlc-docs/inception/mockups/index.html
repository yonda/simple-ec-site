<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›¸ç±ECã‚µã‚¤ãƒˆ - å•†å“ä¸€è¦§</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="container">
            <h1>ğŸ“š æ›¸ç±ECã‚µã‚¤ãƒˆ</h1>
            <nav>
                <a href="index.html">å•†å“ä¸€è¦§</a>
                <a href="cart.html">ã‚«ãƒ¼ãƒˆ <span id="cart-count" class="badge">0</span></a>
                <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <a href="register.html">æ–°è¦ç™»éŒ²</a>
            </nav>
        </div>
    </header>

    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <section class="search-section">
        <div class="container">
            <input type="text" id="search-input" placeholder="æ›¸ç±åã€è‘—è€…åã§æ¤œç´¢..." class="search-box">

            <div class="filters">
                <select id="category-filter">
                    <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
                    <option value="tech">æŠ€è¡“æ›¸</option>
                    <option value="novel">å°èª¬</option>
                    <option value="business">ãƒ“ã‚¸ãƒã‚¹æ›¸</option>
                </select>

                <select id="price-filter">
                    <option value="">ã™ã¹ã¦ã®ä¾¡æ ¼å¸¯</option>
                    <option value="0-1000">ã€œ1,000å††</option>
                    <option value="1000-3000">1,000ã€œ3,000å††</option>
                    <option value="3000-">3,000å††ã€œ</option>
                </select>

                <label>
                    <input type="checkbox" id="stock-filter"> åœ¨åº«ã‚ã‚Š
                </label>
            </div>
        </div>
    </section>

    <!-- å•†å“ä¸€è¦§ -->
    <main class="container">
        <h2>æ›¸ç±ä¸€è¦§</h2>
        <div id="product-list" class="product-grid">
            <!-- JavaScriptã§ç”Ÿæˆ -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 æ›¸ç±ECã‚µã‚¤ãƒˆ</p>
    </footer>

    <script src="data.js"></script>
    <script src="utils.js"></script>
    <script>
        // å•†å“ä¸€è¦§ã®è¡¨ç¤º
        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = '';

            if (products.length === 0) {
                productList.innerHTML = '<p class="no-results">è©²å½“ã™ã‚‹æ›¸ç±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                return;
            }

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = `product-card ${product.stock === 0 ? 'out-of-stock' : ''}`;

                productCard.innerHTML = `
                    <img src="${generateBookCover(product, 200, 280)}" alt="${product.title}">
                    <h3>${product.title}</h3>
                    <p class="author">${product.author}</p>
                    <p class="price">Â¥${product.price.toLocaleString()}</p>
                    <p class="stock ${product.stock === 0 ? 'out-of-stock-text' : product.stock <= 5 ? 'low-stock' : ''}">
                        ${product.stock === 0 ? 'åœ¨åº«åˆ‡ã‚Œ' : product.stock <= 5 ? 'æ®‹ã‚Šã‚ãšã‹' : `åœ¨åº«ï¼š${product.stock}å†Š`}
                    </p>
                    <a href="product-detail.html?id=${product.id}" class="btn btn-primary ${product.stock === 0 ? 'disabled' : ''}">
                        è©³ç´°ã‚’è¦‹ã‚‹
                    </a>
                `;

                productList.appendChild(productCard);
            });
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å‡¦ç†
        function filterProducts() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const category = document.getElementById('category-filter').value;
            const priceRange = document.getElementById('price-filter').value;
            const stockOnly = document.getElementById('stock-filter').checked;

            let filtered = products.filter(product => {
                // æ¤œç´¢
                const matchesSearch = product.title.toLowerCase().includes(searchTerm) ||
                                    product.author.toLowerCase().includes(searchTerm);

                // ã‚«ãƒ†ã‚´ãƒª
                const matchesCategory = !category || product.category === category;

                // ä¾¡æ ¼
                let matchesPrice = true;
                if (priceRange) {
                    const [min, max] = priceRange.split('-').map(p => p ? parseInt(p) : null);
                    if (max) {
                        matchesPrice = product.price >= min && product.price < max;
                    } else {
                        matchesPrice = product.price >= min;
                    }
                }

                // åœ¨åº«
                const matchesStock = !stockOnly || product.stock > 0;

                return matchesSearch && matchesCategory && matchesPrice && matchesStock;
            });

            displayProducts(filtered);
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('search-input').addEventListener('input', filterProducts);
        document.getElementById('category-filter').addEventListener('change', filterProducts);
        document.getElementById('price-filter').addEventListener('change', filterProducts);
        document.getElementById('stock-filter').addEventListener('change', filterProducts);

        // åˆæœŸè¡¨ç¤º
        displayProducts(products);
        updateCartCount();
    </script>
</body>
</html>
