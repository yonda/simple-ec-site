<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ - æ›¸ç±ECã‚µã‚¤ãƒˆ</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header>
        <div class="container">
            <h1>ğŸ“š æ›¸ç±ECã‚µã‚¤ãƒˆ</h1>
            <nav>
                <a href="index.html">å•†å“ä¸€è¦§</a>
                <a href="cart.html">ã‚«ãƒ¼ãƒˆ <span id="cart-count" class="badge">0</span></a>
                <a href="login.html">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <a href="register.html">æ–°è¦ç™»éŒ²</a>
            </nav>
        </div>
    </header>

    <!-- ã‚«ãƒ¼ãƒˆå†…å®¹ -->
    <main class="container">
        <h2>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã‚«ãƒ¼ãƒˆ</h2>

        <div id="cart-content">
            <!-- JavaScriptã§ç”Ÿæˆ -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 æ›¸ç±ECã‚µã‚¤ãƒˆ</p>
    </footer>

    <script src="data.js"></script>
    <script src="utils.js"></script>
    <script>
        function displayCart() {
            const cart = getCart();
            const cartContent = document.getElementById('cart-content');

            if (cart.length === 0) {
                cartContent.innerHTML = '<p class="no-results">ã‚«ãƒ¼ãƒˆã¯ç©ºã§ã™</p>';
                return;
            }

            let cartHTML = '<div class="cart-items">';

            cart.forEach(item => {
                const product = getProductById(item.productId);
                if (!product) return;

                const subtotal = product.price * item.quantity;

                cartHTML += `
                    <div class="cart-item">
                        <img src="${generateBookCover(product, 100, 140)}" alt="${product.title}">
                        <div class="cart-item-info">
                            <h3>${product.title}</h3>
                            <p class="author">${product.author}</p>
                        </div>
                        <div class="cart-item-actions">
                            <p class="price">Â¥${product.price.toLocaleString()}</p>
                            <div class="quantity-selector">
                                <label>æ•°é‡:</label>
                                <input
                                    type="number"
                                    value="${item.quantity}"
                                    min="0"
                                    max="${product.stock}"
                                    onchange="updateQuantity(${product.id}, this.value)"
                                >
                            </div>
                            <p>å°è¨ˆ: Â¥${subtotal.toLocaleString()}</p>
                            <button class="btn btn-danger" onclick="removeItem(${product.id})">å‰Šé™¤</button>
                        </div>
                    </div>
                `;
            });

            cartHTML += '</div>';

            const total = getCartTotal();

            cartHTML += `
                <div class="cart-summary">
                    <div class="total">
                        <span>åˆè¨ˆé‡‘é¡:</span>
                        <span>Â¥${total.toLocaleString()}</span>
                    </div>
                    <a href="checkout.html" class="btn btn-success" style="width: 100%; display: block; text-align: center;">ãƒ¬ã‚¸ã«é€²ã‚€</a>
                </div>
            `;

            cartContent.innerHTML = cartHTML;
        }

        function updateQuantity(productId, quantity) {
            const qty = parseInt(quantity);
            if (qty === 0) {
                if (confirm('ã“ã®å•†å“ã‚’ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    removeFromCart(productId);
                    displayCart();
                }
            } else {
                if (!checkStock(productId, qty)) {
                    alert('åœ¨åº«ã‚’è¶…ãˆã‚‹æ•°é‡ã¯è¨­å®šã§ãã¾ã›ã‚“ã€‚');
                    displayCart();
                    return;
                }
                updateCartItemQuantity(productId, qty);
                displayCart();
            }
        }

        function removeItem(productId) {
            if (confirm('ã“ã®å•†å“ã‚’ã‚«ãƒ¼ãƒˆã‹ã‚‰å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                removeFromCart(productId);
                displayCart();
            }
        }

        displayCart();
    </script>
</body>
</html>
